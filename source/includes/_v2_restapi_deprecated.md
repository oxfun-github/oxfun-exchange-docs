# REST API

**TEST** site

* `https://stgapi.opnx.com`

**LIVE** site

* `https://api.opnx.com`

For clients who do not wish to take advantage of Opnx's native WebSocket API, Opnx offers a RESTful API that implements much of the same functionality.

##Authentication 

> **Request**

```json
{
  "Content-Type": "application/json",
  "AccessKey": "<string>",
  "Timestamp": "<string>", 
  "Signature": "<string>", 
  "Nonce": "<string>"
}
```

### GET `v2/borrowingSummary`

Get borrowing summary.

> **Request**

```json
GET v2/borrowingSummary
```

> **SUCCESSFUL RESPONSE**

```json
{
    "event": "borrowingSummary",
    "timestamp": "1626433981644",
    "accountId": "3123",
    "data": [
        {
            "borrowAsset": "USDT",
            "borrowedAmount": "109031.8252978",
            "collateralAsset": "BTC",
            "collateralizedAmount": "3.65800000",
            "rateType": "FLOATING_RATE",
            "status": "To be repaid"
        },
        ...
    ]
}
```

Response Fields | Type | Description |
----------------| ---- | ----------- |
accountId | STRING | Account ID |
borrowAsset | STRING | Borrow asset, can only be `USDT` for now |
borrowedAmount | STRING | Total borrowed amount of the borrow asset |
collateralAsset | STRING | Collateral asset |
collateralizedAmount | STRING | Total collateralized amount of the collateral asset |
rateType | STRING | `FLOATING_RATE` or `FIXED_RATE` |
status | STRING | `To be repaid` |

### POST `/v2/borrow/close`

Close borrow.

> **Request**

```json
POST /v2/borrow/close

{
    "marketCode": "BTC-USDT-SWAP-LIN",
    "price": "29633.5",
    "quantity": "1"
}
```

> **SUCCESSFUL RESPONSE**

```json
{
    "event": "closeBorrow",
    "timestamp": "1626434069478",
    "accountId": "3123",
    "data": {
        "success": "true",
        "timestamp": "1626434069461",
        "clientOrderId": "1626434069478",
        "orderId": "1000018496331",
        "price": "29633.5",
        "quantity": "1.0",
        "side": "SELL",
        "status": "CANCELED_BY_FOK",
        "marketCode": "BTC-USDT-SWAP-LIN",
        "timeInForce": "FOK",
        "notice": "OrderClosed",
        "orderType": "MARKET",
        "isTriggered": "false"
    }
}
```

Request Parameters | Type | Required | Description |
------------------ | ---- | -------- | ----------- |
marketCode | STRING | YES | Borrow asset, can only be `USDT` for now |
price | STRING | NO | The price to close the borrow, default is the market price |
collateralAmount | STRING | NO | The quantity to close the borrow, default is full position |

Response Fields | Type | Description |
----------------| ---- | ----------- |
accountId | STRING | Account ID |
clientOrderId | STRING | Client assigned ID to help manage and identify orders with max value `9223372036854775807` |
orderId | STRING | Order ID which generated by the server |
price | STRING | Price submitted |
quantity | STRING | Quantity submitted |
side | STRING | Side of the order, `BUY` or `SELL` |
status | STRING | Status of the order |
marketCode | STRING | Market code |
timeInForce | STRING | Time in force |
notice | STRING | `OrderClosed` or `OrderMatched` or `OrderOpend` |
orderType | STRING | Type of the order, `LIMIT` or `STOP` |
isTriggered | STRING | `true`(for stop order) or `false` |


### GET `/v3/orders`

Returns all orders of the account connected to the API key initiating the request.

> **Request**

```
GET /v3/orders?marketCode={marketCode}&orderId={orderId}&clientOrderId={clientOrderId}&limit={limit}&startTime={startTime}&endTime={endTime}
```

> **Successful response format**

```json
{
    "success": true,
    "data": {
        "orderId": "1000387920513",
        "clientOrderId": "1612249737434",
        "marketCode": "FLEX-USDT",
        "status": "OPEN",
        "side": "BUY",
        "price": "5.200",
        "stopPrice": "null",
        "isTriggered": false,
        "quantity": "0.01",
        "remainQuantity": "0.01",
        "matchedQuantity": "0.00",
        "avgFillPrice": "null",
        "avgLeg1Price": "",
        "avgLeg2Price": "",
        "fees": {"USDT": "0", "FLEX": "0"},
        "orderType": "LIMIT",
        "timeInForce": "GTC",
        "source": "0",
        "createdAt": "1655980336520",
        "lastModifiedAt": null,
        "lastMatchedAt": null
    }
}
```
<aside class="notice">
CANCELED orders are not in the orderbook, the remainQuantity in the CANCELED orders is historical remaining quantity
</aside>

Request Parameter | Type | Required | Description |
----------------- | ---- | -------- | ----------- |
marketCode | STRING | default most recent orders first |
orderId | LONG | YES if no clientOrderId | Order ID |
clientOrderId | LONG | YES if no orderId | Client assigned ID to help manage and identify orders with max value `9223372036854775807` |
limit | LONG | NO | Default 50, max 200 |
startTime | LONG | NO | Millisecond timestamp. Default 24 hours ago. startTime and endTime must be within 7 days of each other |
endTime | LONG | NO | Millisecond timestamp. Default time now. startTime and endTime must be within 7 days of each other |


Response Field | Type | Description |
-------------- | ---- | ----------- |
orderId | STRING | Order ID |
clientOrderId | STRING | Client assigned ID to help manage and identify orders with max value `9223372036854775807` |
marketCode | STRING | Market code |
status | STRING | Available values: `CANCELED`, `OPEN`, `PARTIAL_FILL`, `FILLED` |
side | STRING | Side of the order, `BUY` or `SELL` |
price | STRING | Price or limit price in the case of a STOP order |
stopPrice | STRING | Trigger price for a STOP order |
isTriggered | BOOL | `true` for a STOP order |
quantity | STRING |  Quantity |
remainQuantity | STRING | Remaining quantity |
matchedQuantity | STRING | Matched Quantity |
avgFillPrice | STRING | Average of filled price |
leg1Price | STRING | Leg1 price |
leg2Price | STRING | Leg2 price |
fees | LIST of dictionaries | Overall fees with instrument ID, if FLEX is no enough to pay the fee then USDT will be paid |
orderType | STRING | Type of the order, availabe values: `MARKET`, `LIMIT`, `STOP_LIMIT` |
timeInForce | STRING | Client submitted time in force. <ul><li>`GTC` (Good-till-Cancel) - Default</li><li> `IOC` (Immediate or Cancel, i.e. Taker-only)</li><li> `FOK` (Fill or Kill, for full size)</li><li>`MAKER_ONLY` (i.e. Post-only)</li><li> `MAKER_ONLY_REPRICE` (Reprices order to the best maker only price if the specified price were to lead to a taker trade) |
source | STRING | Source of the request, available values: `0`, `2`, `10`, `11`, `22`, `101`, `102`, `103`, `111`. <p>Enumeration: `0: Websocket`, `2: Borrow`, `10: AMM`, `11: REST`, `22: Delivery`, `101: Automatic borrow`, `102: Borrow position liquidation`, `103: Contract liquidation`, `111: Automatic repayment`</p> |
createdAt | STRING | Millisecond timestamp of the order created time |
lastModifiedAt | STRING | Millisecond timestamp of the order last modified time |
lastMatchedAt | STRING | Millisecond timestamp of the order last matched time |

### POST `/v2.1/delivery/orders`

> **Request**

```json
POST /v2.1/delivery/orders
```
```json
{
    "instrumentId": "BTC-USDT-SWAP-LIN",
    "qtyDeliver": "0.1"
}
```

```python
import requests
import hmac
import base64
import hashlib
import datetime
import json

rest_url = 'https://stgapi.opnx.com'
rest_path = 'v2stgapi.opnx.com'

api_key = 'api_key'
api_secret = 'api_secret'

ts = datetime.datetime.utcnow().isoformat()
nonce = 123

# REST API method
method = '/v2.1/delivery/orders'

params = json.dumps({"instrumentId": "BTC-USDT-SWAP-LIN", "qtyDeliver": "0.1"})

msg_string = '{}\n{}\n{}\n{}\n{}\n{}'.format(ts, nonce, 'POST', rest_path, method, params)
sig = base64.b64encode(hmac.new(api_secret.encode('utf-8'), msg_string.encode('utf-8'), hashlib.sha256).digest()).decode('utf-8')

header = {'Content-Type': 'application/json', 'AccessKey': api_key,
          'Timestamp': ts, 'Signature': sig, 'Nonce': str(nonce)}

resp = requests.post(rest_url + method, headers=header, data=params)
print(resp.url)
print(resp.request.headers)
print(resp.request.body)
print(json.dumps(resp.json(), indent=4, separators=(', ', ': ')))
```

> **Response**

```json
{
    "event": "delivery",
    "timestamp": "1648801950009",
    "accountId": "3101",
    "data": [
        {
            "deliverOrderId": "749507542787358724",
            "accountId": "3101",
            "clientOrderId": null,
            "instrumentId": "BTC-USDT-SWAP-LIN",
            "deliverPrice": "45285",
            "deliverPosition": "0.100",
            "deliverType": "NEXT_CYCLE",
            "instrumentIdDeliver": "BTC",
            "deliverQty": "0.100",
            "remainingQty": "0.100",
            "remainingPosition": "0.100",
            "transferAsset": "USDT",
            "transferQty": "4528.500",
            "auctionTime": "1648801949919",
            "created": "1648801949919",
            "lastUpdated": "1648801949919",
            "status": "PENDING"
        }
    ]
}
```

```python
{
    "event": "delivery", 
    "timestamp": "1648801950009", 
    "accountId": "3101", 
    "data": [
        {
            "deliverOrderId": "749507542787358724", 
            "accountId": "3101", 
            "clientOrderId": null, 
            "instrumentId": "BTC-USDT-SWAP-LIN", 
            "deliverPrice": "45285", 
            "deliverPosition": "0.100", 
            "deliverType": "NEXT_CYCLE", 
            "instrumentIdDeliver": "BTC", 
            "deliverQty": "0.100", 
            "remainingQty": "0.100", 
            "remainingPosition": "0.100", 
            "transferAsset": "USDT", 
            "transferQty": "4528.500", 
            "auctionTime": "1648801949919", 
            "created": "1648801949919", 
            "lastUpdated": "1648801949919", 
            "status": "PENDING"
        }
    ]
}
```

Submits a request for physical delivery for a specified perpetual swap instrument and quantity.

<sub>**Request Parameters**</sub> 

Parameters | Type | Required |Description| 
-------------------------- | -----|--------- | -------------|
instrumentId| STRING | YES | Perpetual swap instrument intended for delivery |
qtyDeliver| STRING | YES | Quantity intended for delivery |

<sub>**Response Fields**</sub> 

Field | Type | Description |
----- | ---- | ----------- |
event | STRING | `delivery`
timestamp | STRING | Millisecond timestamp of the repsonse
accountId | STRING | Account ID |
data | LIST of dictionary |
deliverOrderId | STRING | Order id
accountId | STRING    | Account ID|
clientOrderId | Null Type | null |
instrumentId | STRING | Perpetual swap market code
deliverPrice | STRING|  Mark price at delivery
deliverPosition | STRING | Delivered position size
deliverType | STRING| "NEXT_CYCLE": Queueing for the upcoming auction
instrumentIdDeliver | STRING |Asset being received: long position = coin, short position = USDT
deliverQty | STRING |  Quantity of the received asset
remainingQty | STRING | Remaining quantity
remainingPosition | STRING | Remaining position
transferAsset | STRING | Asset being sent
transferQty | STRING | Quantity being sent
auctionTime | STRING | Millisecond timestamp of the next auction
created | STRING | Millisecond timestamp
lastUpdated | STRING | Millisecond timestamp 
status | STRING | Delivery status


### DELETE `/v2.1/delivery/orders/{deliveryOrderId}`
> **Request**

```json
DELETE /v2.1/delivery/orders/{deliveryOrderId}
```

```python
import requests
import hmac
import base64
import hashlib
import datetime
import json

rest_url = 'https://stgapi.opnx.com'
rest_path = 'v2stgapi.opnx.com'

api_key = 'api_key'
api_secret = 'api_key'

ts = datetime.datetime.utcnow().isoformat()
nonce = 123

method = '/v2.1/delivery/orders/{deliveryOrderId}'

params = json.dumps({})

msg_string = '{}\n{}\n{}\n{}\n{}\n{}'.format(ts, nonce, 'DELETE', rest_path, method, params)
sig = base64.b64encode(hmac.new(api_secret.encode('utf-8'), msg_string.encode('utf-8'), hashlib.sha256).digest()).decode('utf-8')

header = {'Content-Type': 'application/json', 'AccessKey': api_key,
          'Timestamp': ts, 'Signature': sig, 'Nonce': str(nonce)}

resp = requests.delete(rest_url + method, headers=header, data=params)
print(resp.url)
print(resp.request.headers)
print(resp.request.body)
print(json.dumps(resp.json(), indent=4, separators=(', ', ': ')))
```

> **Success response**

```json
{
    "event": "delivery", 
    "timestamp": "1648802689667", 
    "accountId": "3101", 
    "data": [
        "Cancel of user order was successful"
    ]
}
```

```python
{
    "event": "delivery", 
    "timestamp": "1648802689667", 
    "accountId": "3101", 
    "data": [
        "Cancel of user order was successful"
    ]
}
```

> **Failure response**

```json
{
    "event": "delivery", 
    "timestamp": "1648803402131", 
    "accountId": "3101", 
    "data": [
        "Cancel exception please try again"
    ]
}
```

```python
{
    "event": "delivery", 
    "timestamp": "1648803402131", 
    "accountId": "3101", 
    "data": [
        "Cancel exception please try again"
    ]
}
```

Cancels a pending delivery.

<sub>**Request Parameters**</sub> 

Parameters | Type | Required | Description | 
-----------| ---- | -------- | ----------- |
deliveryOrderId | STRING | YES | Delivery order ID, please place it in URL |

<sub>**Response Fields**</sub> 

Field | Type | Description |
----- | ---- | ----------- |
event | STRING | `delivery`
timestamp | STRING | Millisecond timestamp of the repsonse
accountId | STRING | Account ID |
data | Array | Message from the server |

### POST `/v2/borrow`

Borrow.

> **Request**

```json
POST /v2/borrow

{
    "borrowAsset": "USDT",
    "collateralAsset": "BTC",
    "collateralAmount": "0.01"
}
```

> **SUCCESSFUL RESPONSE**

```json
{
    "event": "borrow",
    "timestamp": "1626433827430",
    "accountId": "3123",
    "data": {
        "borrowAsset": "USDT",
        "borrowedAmount": "296.21588287",
        "collateralAsset": "BTC",
        "collateralizedAmount": "0.01",
        "nonCollateralizedAmount": "0",
        "rateType": "FLOATING_RATE",
        "status": "COMPLETED",
        "borrowedAt": "1626433827616"
    }
}
```

Request Parameters | Type | Required | Description |
------------------ | ---- | -------- | ----------- |
borrowAsset | STRING | YES | Borrow asset, can only be `USDT` for now |
collateralAsset | STRING | YES | Collateral asset |
collateralAmount | STRING | YES | Collateral amount of the collateral asset |

Response Fields | Type | Description |
----------------| ---- | ----------- |
accountId | STRING | Account ID |
borrowAsset | STRING | Borrow asset, can only be `USDT` for now |
borrowedAmount | STRING | Borrowed amount of the borrow asset |
collateralAsset | STRING | Collateral asset |
collateralizedAmount | STRING | Collateralized amount of the collateral asset |
nonCollateralizedAmount | STRING | `nonCollateralizedAmount` = `collateralAmount` - `collateralizedAmount` |
rateType | STRING | `FLOATING_RATE` or `FIXED_RATE` |
status | STRING | `COMPLETED` or `PARTIAL` or `CANCELLED` |
borrowedAt | STRING | The time of borrowed at |

### POST `/v2/repay`

Repay.

> **Request**

```json
POST /v2/repay

{
    "repayAsset": "USDT",
    "regainAsset": "BTC",
    "regainAmount": "0.001"
}
```

> **SUCCESSFUL RESPONSE**

```json
{
    "event": "repay",
    "timestamp": "1626433876060",
    "accountId": "3123",
    "data": {
        "repayAsset": "USDT",
        "repaidAmount": "31.33109616",
        "regainAsset": "BTC",
        "regainedAmount": "0.001",
        "nonRegainedAmount": "0",
        "status": "COMPLETED",
        "repaidAt": "1626433876398"
    }
}
```

Request Parameters | Type | Required | Description |
------------------ | ---- | -------- | ----------- |
repayAsset | STRING | YES | Repay asset, can only be `USDT` for now |
regainAsset | STRING | YES | Regain asset |
regainAmount | STRING | YES | Regain amount of the regain asset |

Response Fields | Type | Description |
----------------| ---- | ----------- |
accountId | STRING | Account ID |
repayAsset | STRING | Repay asset, can only be `USDT` for now |
repaidAmount | STRING | Repaid amount of the repay asset |
regainAsset | STRING | Regain asset |
regainedAmount | STRING | Already regained amount of the regain asset |
nonRegainedAmount | STRING | `nonRegainedAmount` = `regainAmount` - `regainedAmount` |
status | STRING | `COMPLETED` or `PARTIAL` or `CANCELLED` |
repaidAt | STRING | The time of repaid at |

## Delivery - Private

### GET `/v3/delivery/working`

Get working delivery orders

> **Request**

```
GET /v3/delivery/working?marketCode=SUSHI-USDT-SWAP-LIN
```

> **Successful response format**

```json
{
    "success": true,
    "data": [
        {
            "deliveryId": "777227682229354499",
            "marketCode": "SUSHI-USDT-SWAP-LIN",
            "status": "PENDING",
            "deliveryPrice": "1.189000000",
            "deliveryPosition": "5.000000000",
            "deliveryAsset": "USDT",
            "deliveryQuantity": "5.945000000",
            "receiveAsset": "SUSHI",
            "receiveQuantity": "5.000000000",
            "remainDeliveryPosition": "5.000000000",
            "auctionTime": "1657261465125",
            "createdAt": "1657261465125",
            "lastUpdatedAt": "1657261465125"
        },
        {
            "deliveryId": "777227603892338692",
            "marketCode": "SUSHI-USDT-SWAP-LIN",
            "status": "ROLLED_DELIVERY",
            "deliveryPrice": "1.190000000",
            "deliveryPosition": "2.000000000",
            "deliveryAsset": "USDT",
            "deliveryQuantity": "2.380000000",
            "receiveAsset": "SUSHI",
            "receiveQuantity": "2.000000000",
            "remainDeliveryPosition": "1.900000000",
            "auctionTime": "1657261441216",
            "createdAt": "1657261441216",
            "lastUpdatedAt": "1657261441417"
        }
    ]
}
```

Request Parameter | Type | Required | Description |
----------------- | ---- | -------- | ----------- |
marketCode | STRING | NO | Market code |

Response Field | Type | Description |
-------------- | ---- | ----------- |
deliveryId | STRING | Delivery ID |
marketCode | STRING | Market code |
status | STRING | Status of the order, available values: `PENDING`, `ROLLED_DELIVERY` |
deliveryPrice | STRING | Mark price at the delivery |
deliveryPosition | STRING | Position of the delivery |
deliveryAsset | STRING | Asset being sent |
deliveryQuantity | STRING | Quantity being sent |
receiveAsset | STRING | Asset would be received |
receiveQuantity | STRING | Quantity would be received |
remainDeliveryPosition | STRING | Remaining delivery position |
auctionTime | STRING | Millisecond timestamp of the auction time |
createdAt | STRING | Millisecond timestamp of the created time |
lastUpdatedAt | STRING | Millisecond timestamp of the last updated time |

###GET `/v2/delivery/public/funding`

> **Request**

```json
GET /v2/delivery/public/funding?limit={limit}&startTime={startTime}&endTime{endTime}
```

> **RESPONSE**

```json
[
    {
        "timestamp": "2020-12-08 04:00:00",
        "instrumentId": "COMP-USDT-SWAP-LIN",
        "fundingRate": "0.000000000"
    },
    {
        "timestamp": "2020-12-08 04:00:00",
        "instrumentId": "CRV-USDT-SWAP-LIN",
        "fundingRate": "0.000000000"
    },
    ...
]
```
Get funding rate

Request Parameters | Type | Description| 
-------------------------- | -----|--------- |
column | STRING | limit size of results, e.g. 3 |
instrumentId | STRING | e.g. UNI-USDT-SWAP-LIN |
limit | STRING | default `100`, max `500` |
startTime | STRING | STRING. e.g. `2021-12-08 08:00:00`. Default 24 hours ago. startTime and endTime must be within 7 days of each other |
endTime | STRING | STRING. e.g. `2021-12-08 08:00:00`. Default time now. startTime and endTime must be within 7 days of each other |

Response Parameters | Type | Description| 
-------------------------- | -----|--------- |
timestamp | STRING | Timestamp of this response |
instrumentId | STRING | "BTC-USDT-SWAP-LIN" |
fundingRate| STRING | e.g. 0.000060000 |


### GET `/v2.1/deliver-auction/{instrumentId}`
> **Request**

```json
GET /v2/deliver-auction

GET /v2.1/deliver-auction/<instrumentId>
```

> **RESPONSE**

```json
{
    "event": "deliverAuction",
    "timestamp": "1596620815090",
    "data": [
        {
            "instrumentId": "BTC-USDT-SWAP-LIN",
            "auctionTime": "1596620805000",
            "netDeliver": "-5.100000000",
            "estFundingRate": "0.0001"
        },
      ...
    ]
}
```

Requires authentication. Get entire delivery history.

Response Parameters |Type | Description| 
-------------------------- | -----|--------- |
timestamp | STRING | UNIX Timestamp of the response|
instrumentId | STRING |  Market code
auctionTime | STRING | UNIX timestamp of the next auction
netDeliver | STRING | Delivery imbalance (negative = more shorts than longs and vice versa)
estFundingRate | STRING | Estimated funding rate a positive rate means longs pay shorts

### GET `/v2/funding-rates/{marketCode}`

Get funding rates by marketCode and sorted by time in descending order.

> **Request**

```json
GET /v2/funding-rates/{marketCode}?startTime={startTime}&endTime={endTime}&limit={limit}
```

Request Parameters | Type | Required | Description |
------------------ | ---- | -------- | ----------- |
marketCode | STRING | YES | e.g. BTC-USDT-REPO-LIN , available values: BTC-USDT-REPO-LIN, ETH-USDT-REPO-LIN |
limit | LONG | NO | default is `50` |
startTime | LONG | NO | millisecond timestamp, e.g. `1579450778000`, default is 7 days ago from time now |
endTime | LONG | NO | millisecond timestamp, e.g. `1613978625000`, default is time now |

> **SUCCESSFUL RESPONSE**

```json
{
    "event": "fundingRates",
    "timestamp": "1611645666834",
    "data": [
        {
            "fundingRate": "0.00008",
            "index": "2.78222423",
            "markPrice": "33937.2848",
            "marketCode": "BTC-USDT-REPO-LIN",
            "timestamp": "1606461774458"
        },
        ...
    ]
}
```

Response Fields | Type | Description |
------------------- | ---- | ----------- |
timestamp | STRING | Timestamp of this response |
fundingRate | STRING | |
index | STRING | |
markPrice | STRING | |
marketCode | STRING | |
timestamp(in the data list) | STRING | |

### GET `/v3/funding-rates`

Get historical funding rates.

> **Request**

```
GET /v3/funding-rates?marketCode={marketCode}&limit={limit}
&startTime={startTime}&endTime={endTime}
```

> **Successful response format**

```json
{
    "success": true,
    "data": [
        {
            "marketCode": "BTC-USDT-SWAP-LIN",
            "fundingRate": "0.0",
            "netDelivered": "0",
            "createdAt": "1628362803134"
        },
        {
            "marketCode": "BTC-USDT-SWAP-LIN",
            "fundingRate": "0.0",
            "netDelivered": "0",
            "createdAt": "1628359202941"
        }
    ]
}
```

Request Parameter | Type | Required | Description |
----------------- | ---- | -------- | ----------- |
marketCode | STRING | NO | Market code |
limit | LONG | NO | Default 200, max 500 |
startTime | LONG | NO | Millisecond timestamp. Default 24 hours ago. startTime and endTime must be within 7 days of each other. |
endTime | LONG | NO |  Millisecond timestamp. Default time now. startTime and endTime must be within 7 days of each other. |

Response Field | Type | Description |
-------------- | ---- | ----------- |
marketCode | STRING | Market code |
fundingRate | STRING | Funding rate |
netDelivered | STRING | Delivery imbalance (negative = more shorts than longs and vice versa) |
createdAt | STRING | Millisecond timestamp |


### GET `/v3/auction`

Get upcoming delivery auction.

> **Request**

```
GET /v3/auction?marketCode={marketCode}
```

> **Successful response format**

```json
{
    "success": true,
    "data": [
        {
            "marketCode": "BTC-USDT-SWAP-LIN",
            "auctionTime": "1642590000000",
            "netDelivered": "0",
            "estFundingRate": "0"
        }
    ]
}
```

Request Parameter | Type | Required | Description |
----------------- | ---- | -------- | ----------- |
marketCode | STRING | NO | Market code |

Response Field | Type | Description |
-------------- | ---- | ----------- |
marketCode | STRING | Market code |
auctionTime | STRING | Millisecond timestamp of the next auction |
netDelivered | STRING | Delivery imbalance (negative = more shorts than longs and vice versa) |
estFundingRate | STRING | Estimated funding rate, a positive rate means longs pay shorts |




## AMM - Private


### POST `/v3/AMM/create`

Create AMM

* Leveraged buy or sell or neutral

> **Request**

```
POST /v3/AMM/create
```

> **Parameters to create a leveraged buy, sell, or neutral AMM**

```json
{
    "leverage": "5",
    "direction": "BUY",
    "marketCode": "BCH-USDT-SWAP-LIN",
    "collateralAsset": "BCH",
    "collateralQuantity": "50",
    "minPriceBound": "200",
    "maxPriceBound": "800"
}
```

> **Successful response format**

```json
{
    "success": true,
    "data": {
        "hashToken": "CF-BCH-AMM-ABCDE3iy",
        "leverage": "5",
        "direction": "BUY",
        "marketCode": "BCH-USDT-SWAP-LIN",
        "collateralAsset": "BCH",    
        "collateralQuantity": "50",                
        "minPriceBound": "200",
        "maxPriceBound": "800"
    }
}
```

Request Parameter | Type | Required | Description |
----------------- | ---- | -------- | ----------- |
leverage | STRING | NO | String from 1 to 10 |
direction | STRING | YES | Available values: `BUY` and `SELL` |
marketCode | STRING | YES | Market code |
collateralAsset | STRING | NO | Collateral asset, required when using leverage |
collateralQuantity | STRING | NO | Collateral quantity, minimum notional $200, required when using leverage |
baseQuantity | STRING | NO |  Base asset quantity, required for unleveraged sell, and neutral AMMs. |
counterQuantity | STRING | NO | Counter asset quantity, required for unleveraged buy, and neutral AMMs |
minPriceBound | STRING | YES | Minimum price bound |
maxPriceBound | STRING | YES | Maximum price bound |

Response Field | Type | Description |
-------------- | ---- | ----------- |
hashToken | STRING | Hash token |
leverage | STRING | Leverage, string from 1 to 10 |
direction | STRING | Available values: `BUY` and `SELL` |
marketCode | STRING | Market code |
collateralAsset | STRING | Collateral asset |
collateralQuantity | STRING | Collateral quantity, minimum notional $200 |
baseAsset | STRING | Base asset |
baseQuantity | STRING | Base asset quantity, required for unleveraged sell, and neutral AMMs |
counterAsset | STRING | Counter asset |
counterQuantity | STRING | Counter asset quantity, required for unleveraged buy, and neutral AMMs |
minPriceBound | STRING | Minimum price bound |
maxPriceBound | STRING | Maximum price bound |

* Unleveraged buy

> **Unleveraged buy AMM**

```json
{
    "direction": "BUY",
    "marketCode": "BCH-USDT-SWAP-LIN",
    "counterQuantity": "250",
    "minPriceBound": "200",
    "maxPriceBound": "800"
}
```

> **Successful response format**

```json
{
    "success": true,
    "data": {
        "hashToken": "CF-BCH-AMM-ABCDE3iy",
        "direction": "BUY",
        "marketCode": "BCH-USDT-SWAP-LIN",
        "counterAsset": "USDT",
        "counterQuantity": "50",
        "minPriceBound": "200",
        "maxPriceBound": "800"
    }
}
```


* Unleveraged neutral

For unleveraged neutral AMMs the mid point of the price bounds has to equal counterQuantity / baseQuantity.

> **Unleveraged neutral AMM**

```json
{
    "direction": "NEUTRAL",
    "marketCode": "BCH-USDT-SWAP-LIN",
    "baseQuantity": "1",
    "counterQuantity": "500",
    "minPriceBound": "200",
    "maxPriceBound": "800"
}
```

> **Successful response format**

```json
{
    "success": true,
    "data": {
        "hashToken": "CF-BCH-AMM-ABCDE3iy",
        "direction": "BUY",
        "marketCode": "BCH-USDT-SWAP-LIN",
        "baseAsset": "BCH",
        "counterAsset": "USDT",
        "baseQuantity": "1",
        "counterQuantity": "500",
        "minPriceBound": "200",
        "maxPriceBound": "800"
    }
}
```

### POST `/v3/AMM/redeem`

Redeem AMM

<aside class="notice">
AMMs can be created by either the father account or child account. The AMM becomes the child of the account that created it. Father accounts can redeem any AMM into any account. Child accounts can redeem their child AMMs only into their account.
</aside>

> **Request**

```
POST /v3/AMM/redeem
```

```json
{
    "hashToken": "CF-BCH-AMM-ABCDE3iy",
    "type":"DELIVER",
    "accountId": "9546"
}
```

> **Successful response format**

```json
{
    "success": true,
    "data": {
        "hashToken": "CF-BCH-AMM-ABCDE3iy",
        "type":"DELIVER",
        "accountId": "9546"
    }
}
```

Request Parameter | Type | Required | Description |
------------------ | ---- | -------- | ----------- |
hashToken | STRING | YES | Hash token |
type | STRING | YES | Available values: `DELIVER` and `MANUAL`. `DELIVER` invokes physical delivery, the AMM must have the appropriate balance to trigger delivery. `MANUAL` cancels all working orders and creates a sub account that is accessible from the dashboard. |
accountId | STRING | NO | Account ID |

Response Field | Type | Description |
-------------- | ---- | ----------- |
hashToken | STRING | Hash token |
type | STRING | Available values: `DELIVER` and `MANUAL` |
accountId | STRING | Account ID |


### GET `/v3/AMM`

Get AMM information

> **Request**

```
GET /v3/AMM?hashToken={hashToken},{hashToken}
```

> **Successful response format**

```json
{
    "success": true,
    "data": {
        "hashToken": "CF-BCH-AMM-ABCDE3iy",
        "leverage": "3",
        "direction": "BUY",
        "marketCode": "BCH-USDT-SWAP-LIN",
        "initialCollateral": {
            "BCH": "123"
        },
        "minPriceBound": "200",
        "maxPriceBound": "800",
        "status": "ENDED",
        "positions": [
            {
                "marketCode": "BTC-USDT-SWAP-LIN",
                "baseAsset": "BTC",
                "counterAsset": "USDT",
                "position": "0.94",
                "entryPrice": "7800.00",
                "markPrice": "33000.00",
                "positionPnl": "200.3",
                "estLiquidationPrice": "12000.05",
                "lastUpdatedAt": "1592486212218"
            }
        ],
        "balances": [
            {
                "asset": "BTC",
                "total": "4468.823",
                "available": "4468.823",
                "reserved": "0",
                "lastUpdatedAt": "1593627415223"
            }
        ],
        "usdReward": "200",
        "flexReward": "200",
        "interestPaid": "123",
        "apr": "120",
        "volume": "2143324.342",
        "collateral": "1231231",
        "portfolioVarMargin": "500",
        "riskRatio": "20.0000",
        "maintenanceMargin": "1231",
        "marginRatio": "12.3179",
        "liquidating": false,
        "feeTier": "6",
        "createdAt": "1623042343252",
        "lastUpdatedAt": "1623142532134"
    }
}
```

Request Parameter | Type | Required | Description |
------------------ | ---- | -------- | ----------- |
hashToken | STRING | YES | Multiple hashTokens can be separated with a comma, maximum of 5 hashTokens, e.g. `CF-BCH-AMM-ABCDE3iy,CF-BCH-AMM-ABCDE4iy` |

Response Field | Type | Description |
-------------- | ---- | ----------- |
hashToken | STRING | Hash token |
leverage | STRING | Leverage if applicable |
direction | STRING | Direction |
marketCode | STRING | Market code |
initialCollateral | JSON | Initial collateral |
minPriceBound | STRING | Minimum price bound |
maxPriceBound | STRING | Maximum price bound |
status | STRING | Status |
positions | LIST of dictionaries | Positions |
baseAsset | STRING | Base asset |
counterAsset | STRING | Counter asset |
position | STRING | Position |
entryPrice | STRING | Entry price |
markPrice | STRING | Mark price |
positionPnl | STRING | Position PNL |
estLiquidationPrice | STRING | Estimated liquidation price |
lastUpdatedAt | STRING | Timestamp |
marginBalance | STRING |Appears in the position section only for positions using isolated margin. Isolated margin + Unrealized position PnL|
maintenanceMargin | STRING |Appears in the position section only for positions using isolated margin|
marginRatio | STRING | Appears in the position section only for positions using isolated margin|
leverage | STRING | Appears in the position section only for positions using isolated margin|
balances | LIST of dictionaries | Balances |
asset | STRING | Asset |
total | STRING | Total balance |
available | STRING | Available balance |
reserved | STRING | Reserved balance |
usdReward | STRING | USDT reward from scalping |
flexReward | STRING | FLEX reward from fee rebates |
interestPaid | STRING | Interest paid, positive values imply interest was paid to the AMM, negative values imply interest was paid by the AMM |
apr | STRING | APR denotes annual percentage rate |
volume | STRING | Traded volume |
collateral | STRING | Collateral |
notionalPositionSize | STRING | Notional position size |
portfolioVarMargin | STRING | Portfolio margin |
riskRatio | STRING | collateralBalance / portfolioVarMargin, Orders are rejected/cancelled if the risk ratio drops below 1 and liquidation occurs if the risk ratio drops below 0.5 |
maintenanceMargin | STRING | Maintenance margin |
marginRatio | STRING | Margin ratio |
liquidating | BOOL | Available values: `true` and `false` |
feeTier | STRING | Fee tier |
createdAt | STRING | AMM creation millisecond timestamp |


### GET `/v3/AMM/balances`

Get AMM balances

> **Request**

```
GET /v3/AMM/balances?hashToken={hashToken},{hashToken}&asset={asset}
```

> **Successful response format**

```json
{
    "success": true,
    "data": [
        {
            "hashToken": "CF-BCH-AMM-ABCDE3iy",
            "balances": [
                {
                    "asset": "BTC",
                    "total": "4468.823",              
                    "available": "4468.823",        
                    "reserved": "0",
                    "lastUpdatedAt": "1593627415234"
                },
                {
                    "asset": "FLEX",
                    "total": "1585.890",              
                    "available": "325.890",         
                    "reserved": "1260",
                    "lastUpdatedAt": "1593627415123"
                }
            ]
        }
    ]
}
```

Request Parameter | Type | Required | Description |
------------------ | ---- | -------- | ----------- |
hashToken | STRING | YES | Multiple hashTokens can be separated with a comma, maximum of 5 hashTokens, e.g. `CF-BCH-AMM-ABCDE3iy,CF-BCH-AMM-ABCDE4iy` |
asset | STRING | NO | |

Response Field | Type | Description |
-------------- | ---- | ----------- |
hashToken | STRING | Hash token |
balances | LIST of dictionaries | Balances |
asset | STRING | Asset |
total | STRING | Total balance |
available | STRING | Available balance |
reserved | STRING | Reserved balance |
lastUpdatedAt | STRING | Millisecond timestamp of last updated at |

### GET `/v3/AMM/positions`

Get AMM positions

> **Request**

```
GET /v3/AMM/positions?hashToken={hashToken},{hashToken}&marketCode={marketCode}
```

> **Successful response format**

```json
{
    "success": true,
    "data": [
        {
            "hashToken": "CF-BCH-AMM-ABCDE3iy",
            "positions": [
                {
                    "marketCode": "BTC-USDT-SWAP-LIN",
                    "baseAsset": "BTC",
                    "counterAsset": "USDT",
                    "position": "0.94",
                    "entryPrice": "7800.00", 
                    "markPrice": "33000.00", 
                    "positionPnl": "200.3",
                    "estLiquidationPrice": "12000.05",
                    "lastUpdatedAt": "1592486212218"
                }
            ]
        }
    ]
}
```

Request Parameter | Type | Required | Description |
------------------ | ---- | -------- | ----------- |
hashToken | STRING | YES | Multiple hashTokens can be separated with a comma, maximum of 5 hashTokens, e.g. `CF-BCH-AMM-ABCDE3iy,CF-BCH-AMM-ABCDE4iy` |
marketCode | STRING | NO | Market code |

Response Field | Type | Description |
-------------- | ---- | ----------- |
hashToken | STRING | Hash token |
positions | LIST of dictionaries | Positions |
marketCode | STRING | Market code |
baseAsset | STRING | Base asset |
counterAsset | STRING | Counter asset |
position | STRING | Position size |
entryPrice | STRING | Entry price |
markPrice | STRING | Mark price |
positionPnl | STRING | Position PNL |
estLiquidationPrice | STRING | Estimated liquidation price |
lastUpdatedAt | STRING | Millisecond timestamp of last updated at |

### GET `/v3/AMM/orders`

Get AMM orders

> **Request**

```
GET /v3/AMM/orders?hashToken={hashToken}

```

> **Successful response format**

```json
{ 
    "success": true,
    "data": [
        {
            "orderId": "304354590153349202",
            "clientOrderId": "1",
            "marketCode": "BTC-USDT-SWAP-LIN", 
            "status": "OPEN",
            "side": "BUY", 
            "price": "1.0",
            "quantity": "0.001",
            "remainQuantity": "0.001",
            "matchedQuantity": "0",
            "orderType": "LIMIT", 
            "timeInForce": "GTC",
            "createdAt": "1613089383656", 
            "lastModifiedAt": "1613089393622",
            "lastMatchedAt": "1613099383613"
        }
    ]
}
```

Request Parameter | Type | Required | Description |
------------------ | ---- | -------- | ----------- |
hashToken | STRING | YES | Maximum 1 hashToken, e.g. `CF-BCH-AMM-ABCDE3iy` |

Response Field | Type | Description |
-------------- | ---- | ----------- |
orderId | STRING | Order ID |
clientOrderId | STRING | Client assigned ID to help manage and identify orders with max value `9223372036854775807` |
marketCode | STRING | Market code |
status | STRING | Available values: `PARTIALLY_FILLED` and `OPEN` |
side | STRING | Available values: `BUY` and `SELL` |
price | STRING | Limit price |
stopPrice | STRING | Stop price if applicable |
isTriggered | BOOL | Available values: `true` and `false` if applicable |
quantity | STRING | Quantity |
remainQuantity | STRING | Remaining order quantity |
matchedQuantity | STRING | Matched quantity |
orderType | STRING | Available values: `LIMIT` or `STOP` |
timeInForce | STRING | Time in force |
createdAt | STRING | Timestamp |
lastModifiedAt | STRING | Millisecond timestamp if applicable|
lastMatchedAt | STRING | Millisecond timestamp if applicable|

### GET `/v3/AMM/trades`

Get AMM trades. Trades are filtered in descending order (most recent first)

> **Request**

```
GET /v3/AMM/trades?hashToken={hashToken}&marketCode={marketCode}&limit={limit}&startTime={startTime}&endTime={endTime}
```

> **Successful response format**

```json
{    
    "success": true,
    "data": [
        {         
            "orderId": "1000099731323", 
            "clientOrderId": "16", 
            "matchId": "2001011000000", 
            "marketCode": "BTC-USDT-SWAP-LIN", 
            "side": "SELL", 
            "matchedQuantity": "0.001", 
            "matchPrice": "50625", 
            "total": "50.625", 
            "orderMatchType": "MAKER", 
            "feeAsset": "FLEX",
            "fee": "-0.00307938", 
            "lastMatchedAt": "1639016502495"
        }
    ]
}
```

Request Parameter | Type | Required | Description |
------------------ | ---- | -------- | ----------- |
hashToken | STRING | YES | Single hashToken e.g. `CF-BCH-AMM-ABCDE3iy` |
marketCode | STRING | NO | Market code |
limit | LONG | NO | Default 200, max 500, if the limit is reached and there are more trade records with the same millisecond timestamp as any of the included records, ignore the limit and return all of the additional trades that were recorded with that millisecond timestamp |
startTime | LONG | NO | Millisecond timestamp. Default 24 hours ago. startTime and endTime must be within 7 days of each other |
endTime | LONG | NO | Millisecond timestamp. Default time now. startTime and endTime must be within 7 days of each other |

Response Field | Type | Description |
-------------- | ---- | ----------- |
orderId | STRING | Order ID |
clientOrderId | STRING | Client assigned ID to help manage and identify orders with max value `9223372036854775807` |
matchId | STRING | Match ID |
marketCode | STRING | Market code |
side | STRING | Available values: `BUY` and `SELL` |
matchedQuantity | STRING | Matched quantity |
matchPrice | STRING | Match price |
total | STRING | Total price |
leg1Price | STRING | |
leg2Price | STRING | |
orderMatchType | STRING | Available values: `TAKER` and `MAKER` |
feeAsset | STRING | Fee asset |
fee | STRING | Fee |
lastMatchedAt | STRING | Millisecond timestamp |


### GET `/v3/AMM/hash-token`

Get AMM hashTokens in descending order (most recent first)

<aside class="notice">
Parent account API key can search all subaccount hashTokens
</aside>

> **Request**

```
GET /v3/AMM/hash-token?status={status}&marketCode={marketCode}&limit={limit}&startTime={startTime}&endTime={endTime}
```

> **Successful response format**

```json
{
    "success": true,
    "data": [
        {
            "hashToken": "CF-ETH-AMM-607973",
            "direction": "BUY",
            "marketCode": "ETH-USDT-SWAP-LIN",
            "minPriceBound": "3340",
            "maxPriceBound": "3380",
            "status": "EXECUTING",
            "createdAt": "1649630816578"
        },
        {
            "hashToken": "CF-BCH-AMM-607818",
            "direction": "SELL",
            "marketCode": "BCH-USDT-SWAP-LIN",
            "minPriceBound": "300",
            "maxPriceBound": "1500",
            "status": "EXECUTING",
            "createdAt": "1649544662014"
        }
    ]
}
```

Request Parameter | Type | Required | Description |
------------------ | ---- | -------- | ----------- |
status | STRING | NO | Available values: `EXECUTING`, `ENDED`, `PENDING`, `LIQUIDATED` |
marketCode | STRING | NO | Market code |
limit | LONG | NO | Default 200, max 500 |
startTime | LONG | NO | Millisecond timestamp. Default 24 hours ago. startTime and endTime must be within 7 days of each other |
endTime | LONG | NO | Millisecond timestamp. Default time now. startTime and endTime must be within 7 days of each other |

Response Field | Type | Description |
-------------- | ---- | ----------- |
hashToken | STRING | hashToken e.g. `CF-BCH-AMM-ABCDE3iy` |
direction | STRING | Available values: `BUY` and `SELL` |
marketcode | STRING | Market code |
minPriceBound | STRING | Minimum price bound |
maxPriceBound | STRING | Maximum price bound |
status | STRING | Available values: `EXECUTING`, `ENDED`, `PENDING`, `LIQUIDATED` |
createdAt | STRING | Millisecond timestamp |


## Flex Assets - Private

### POST `/v3/flexasset/mint`

Mint

> **Request**

```
POST /v3/flexasset/mint
```
```json
{
    "asset": "flexUSD",
    "quantity": "100"
}
```

> **Successful response format**

```json
{
    "success": true,
    "data": {
        "asset": "flexUSD",
        "quantity": "100"
    }
}
```
<aside class="notice">
Minting is restricted starting 1 minute before an interest payment until 1 minute after the interest payment.
Interest payments occur at 04:00, 12:00, and 20:00 UTC.
</aside>

Request Parameter | Type | Required | Description |
----------------- | ---- | -------- | ----------- |
asset | STRING | YES | Asset name, available assets e.g. `flexUSD`, `flexBTC`, `flexETH`, `flexFLEX`, `flexAXS`, `flexBNB` |
quantity | STRING | YES | Quantity to mint, minimum quantity required: `10 flexUSD`, `0.001 flexBTC`, `0.1 flexETH`, `100 flexFLEX`, `1 flexAXS`, `1 flexBNB` |

Response Field | Type | Description |
-------------- | ---- | ----------- |
asset | STRING | |
quantity | STRING | |


### POST `/v3/flexasset/redeem`

Redeem

> **Request**

```
POST /v3/flexasset/redeem
```
```json
{
    "asset": "flexUSD",
    "quantity": "100",
    "type": "NORMAL"
}
```

> **Successful response format**

```json
{
    "success": true,
    "data": {
        "asset": "flexUSD",
        "quantity": "100",
        "type": "NORMAL",
        "redemptionAt": "1617940800000"
    }
}
```

<aside class="notice">
Redemptions of any type are restricted starting 1 minute before an interest payment until 1 minute after the interest payment.
Interest payments occur at 04:00, 12:00, and 20:00 UTC.
</aside>

Request Parameter | Type | Required | Description | 
----------------- | ---- | -------- | ----------- |
asset | STRING | YES | Asset name, available assets e.g. `flexUSD`, `flexBTC`, `flexETH`, `flexFLEX`, `flexAXS`, `flexBNB` |
quantity | STRING | YES | Quantity to redeem, minimum quantity required: `10 flexUSD`, `0.001 flexBTC`, `0.1 flexETH`, `100 flexFLEX`, `1 flexAXS`, `1 flexBNB` |
type | STRING | YES | `NORMAL` queues a redemption until the following interest payment and incurs no fee. `INSTANT` instantly redeems into the underlying asset and charges a fee equal to the sum of the two prior interest payments


Response Field | Type | Description |
-------------- | ---- | ----------- |
asset | STRING |  |
quantity | STRING | |
type | STRING | Available types: `NORMAL`, `INSTANT` |
redemptionAt | STRING | Millisecond timestamp indicating when redemption will take place|


### GET `/v3/flexasset/mint`

Get mint history by asset and sorted by time in descending order.

> **Request**

```
GET /v3/flexasset/mint?asset={asset}&limit={limit}&startTime={startTime}&endTime={endTime}
```

> **Successful response format**

```json
{
    "success": true,
    "data": [
        {
          "asset": "flexUSD",
          "quantity": "1000.0",
          "mintedAt": "16003243243242"
        }
    ]
}
```

Request Parameter | Type | Required | Description | 
----------------- | ---- | -------- | ----------- |
asset | STRING | NO | Asset name, available assets: `flexUSD`, `flexBTC`, `flexETH`, `flexFLEX` |
limit | LONG | NO | Default 50, max 200 |
startTime | LONG | NO | Millisecond timestamp. Default 24 hours ago. startTime and endTime must be within 7 days of each other |
endTime | LONG | NO | Millisecond timestamp. Default time now. startTime and endTime must be within 7 days of each other |

Response Field | Type | Description |
-------------- | ---- | ----------- |
asset | STRING | |
quantity | STRING | |
mintedAt | STRING | |


### GET `/v3/flexasset/redeem`

Get redemption history by asset and sorted by time in descending order.

> **Request**

```
GET /v3/flexasset/redeem?asset={asset}&limit={limit}&startTime={startTime}&endTime={endTime}
```

> **Successful response format**

```json
{
    "success": true,
    "data": [
        {
          "asset": "flexUSD",
          "quantity": "1000.0",
          "requestedAt": "16003243243242",
          "redeemedAt": "16003243243242"
        }
    ]
}
```

Request Parameter | Type | Required | Description | 
----------------- | ---- | -------- | ----------- |
asset | STRING | NO | Asset name, available assets: `flexUSD`, `flexBTC`, `flexETH`, `flexFLEX` |
limit | LONG | NO | Default 50, max 200 |
startTime | LONG | NO | Millisecond timestamp. Default 24 hours ago. startTime and endTime must be within 7 days of each other. Here startTime and endTime refer to the "requestedAt" timestamp |
endTime | LONG | NO | Millisecond timestamp. Default time now. startTime and endTime must be within 7 days of each other. Here startTime and endTime refer to the "requestedAt" timestamp |


Response Field | Type | Description | 
-------------- | ---- | ----------- |
asset | STRING | |
quantity | STRING | |
requestedAt | STRING | Millisecond timestamp indicating when redemption was requested|
redeemedAt | STRING | Millisecond timestamp indicating when the flexAssets were redeemed |


### GET `/v3/flexasset/earned`

Get earned history by asset and sorted by time in descending order.

> **Request**

```
GET /v3/flexasset/earned?asset={asset}&limit={limit}&startTime={startTime}&endTime={endTime}
```

> **Successful response format**

```json
{
    "success": true,
    "data": [
        {
            "asset": "flexUSD",
            "snapshotQuantity": "10000",
            "apr": "25",
            "rate": "0.00022831",
            "amount": "2.28310502",
            "paidAt": "1635822660847"
        }
    ]
}
```

Request Parameter | Type | Required | Description | 
----------------- | ---- | -------- | ----------- |
asset | STRING | NO | Asset name, available assets: `flexUSD`, `flexBTC`, `flexETH`, `flexFLEX` |
limit | LONG | NO | Default 50, max 200 |
startTime | LONG | NO | Millisecond timestamp. Default 24 hours ago. startTime and endTime must be within 7 days of each other |
endTime | LONG | NO | Millisecond timestamp. Default time now. startTime and endTime must be within 7 days of each other |

Response Field | Type | Description | 
-------------- | ---- | ----------- |
asset | STRING | Asset name |
snapshotQuantity | STRING |
apr | STRING | Annualized APR (%) = rate * 3 * 365 * 100 |
rate | STRING | Period interest rate |
amount | STRING | |
paidAt | STRING | |


## Flex Assets - Public


### GET `/v3/flexasset/balances`

Get flexAsset balances.

> **Request**

```
GET /v3/flexasset/balances?flexasset={flexasset}
```

> **Successful response format**

```json
{
    "success": true, 
    "flexasset": "flexUSD", 
    "data": [
        {
            "asset": "USDT", 
            "total": "110.78000000", 
            "available": "110.78000000", 
            "reserved": "0", 
            "lastUpdatedAt": "1642735371714"
        }
    ]
}
```

Request Parameter | Type | Required | Description |
----------------- | ---- | -------- | ----------- |
flexasset | STRING | YES | FlexAsset name, available assets e.g. `flexUSD`, `flexBTC`, `flexETH`, `flexFLEX` |

Response Field | Type | Description |
-------------- | ---- | ----------- |
asset | STRING | Asset name, e.g. 'BTC' |
total | STRING | Total balance |
available | STRING | Available balance |
reserved | STRING | Reserved balance (unavailable) due to working spot orders |
lastUpdatedAt | STRING | Millisecond timestamp of the latest balance update |


### GET `/v3/flexasset/positions`

Get flexAsset positions.

> **Request**

```
GET /v3/flexasset/positions?flexasset={flexasset}
```

> **Successful response format**

```json
{
    "success": true,
    "flexasset": "flexUSD",
    "data": [
        {
            "marketCode": "BCH-USDT-SWAP-LIN",
            "baseAsset": "BCH",
            "counterAsset": "USDT",
            "quantity": "-4363.81",
            "entryPrice": "380.69",
            "markPrice": "297.74",
            "positionPnl": "-361978.0395",
            "estLiquidationPrice": "0",
            "lastUpdatedAt": "1643173228911"
        },
        {
            "marketCode": "BTC-USDT-SWAP-LIN",
            "baseAsset": "BTC",
            "counterAsset": "USDT",
            "quantity": "-28.931000000",
            "entryPrice": "43100.5",
            "markPrice": "37850.2",
            "positionPnl": "151896.4293000000",
            "estLiquidationPrice": "345678367498.5",
            "lastUpdatedAt": "1642666693674"
        }
    ]
}
```

Request Parameter | Type | Required | Description |
----------------- | ---- | -------- | ----------- |
flexasset | STRING | YES | FlexAsset name, available assets e.g. `flexUSD`, `flexBTC`, `flexETH`, `flexFLEX` |

Response Field | Type | Description |
-------------- | ---- | ----------- |
marketCode | STRING | Market code |
baseAsset | STRING | Base asset |
counterAsset | STRING | Counter asset |
quantity | STRING | Position size |
entryPrice | STRING | Average entry price |
markPrice | STRING | Mark price |
positionPnl | STRING | Postion profit and loss |
estLiquidationPrice | STRING | Estimated liquidation price, return 0 if it is negative (&lt;0) |
lastUpdatedAt | STRING | Millisecond timestamp of the latest position update |


### GET `/v3/flexasset/yields`

Get flexasset yields.

> **Request**

```
GET /v3/flexasset/yields?flexasset={flexasset}&limit={limit}&startTime={startTime}&endTime={endTime}
```

> **Successful response format**

```json
{
    "success": true,
    "data": [
        {
            "flexasset": "flexBTC",
            "apr": "0",
            "yield": "0",
            "paidAt": "1643193000000"
        },
        {
            "flexasset": "flexUSD",
            "apr": "0",
            "yield": "0",
            "paidAt": "1643193000000"
        }
    ]
}
```

Request Parameter | Type | Required | Description |
----------------- | ---- | -------- | ----------- |
flexasset | STRING | NO | FlexAsset name, available assets e.g. `flexUSD`, `flexBTC`, `flexETH`, `flexFLEX` |
limit | LONG | NO | Default 200, max 500 |
startTime | LONG | NO | Millisecond timestamp. Default 24 hours ago. startTime and endTime must be within 7 days of each other. |
endTime | LONG | NO |  Millisecond timestamp. Default time now. startTime and endTime must be within 7 days of each other. |

Response Field | Type | Description |
-------------- | ---- | ----------- |
flexasset | STRING | Asset name, available assets e.g. `flexUSD`, `flexBTC`, `flexETH`, `flexFLEX` |
apr | STRING | Annualized APR (%) = yield * 3 * 365 * 100 |
yield | STRING | Period yield |
paidAt | STRING | Millisecond timestamp of the interest payment |


### POST `/v3/leverage`

Increase or decrease your leverage. This endpoint is used in markets that support isolated margin.

> **Request**

```
POST /v3/leverage
```
```json
{
    "marketCode": "BTC-USDT-SWAP-LIN",
    "leverage": 3
}
```

> **Successful response format**

```json
{
    "success": true,
    "data":{
        "marketCode": "BTC-USDT-SWAP-LIN",
        "leverage": 2,
        "maxPositionSize": "1000000"
    }
}
```

Request Parameter | Type | Required | Description | 
----------------- | ---- | -------- | ----------- |
marketCode | STRING | YES | |
leverage | STRING | YES | |

Response Field | Type | Description | 
-------------- | ---- | ----------- |
marketCode | STRING | |
leverage | STRING | |
maxPositionSize | STRING | |


### POST `/v3/position/adjust`

Add to or reduce your margin balance when using isolated margin.

> **Request**

```
POST /v3/position/adjust
```
```json
{
    "marketCode": "BTC-USDT-SWAP-LIN",
    "amount": "100",
    "type": "ADD"
}
```

> **Successful response format**

```json
{     
"success": true,     
"data": { 
        "type": "ADD",       
        "amount": "100.0",       
        "marginBalance": "150.5"   
 }
}
```

Request Parameter | Type | Required | Description | 
----------------- | ---- | -------- | ----------- |
marketCode | STRING | YES | |
amount | STRING | YES | Must be a positive value |
type | STRING | YES | `ADD`, `REDUCE`|

Response Field | Type | Description | 
-------------- | ---- | ----------- |
type | STRING | |
amount | STRING | |
marginBalance | STRING | |


# Historical Data

Opnx's historical L2 order book data (depth data), can be found at [https://docs.tardis.dev/historical-data-details/opnx] (https://docs.tardis.dev/historical-data-details/opnx) (third party API), which includes historical market data details - instruments, data coverage and data collection specifics for all of our instruments since 2020-07-14.

